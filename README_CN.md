# CS2-PlayerModelChanger
一个轻量的counterstrikesharp插件，用于改变玩家模型
- **[用前须知](#用前须知)**
- [已知问题](#k已知问题)
- [依赖插件](#依赖插件)
- [安装指南](#安装指南)
- [命令](#命令)
- [配置](#配置)
- [如何添加自定义模型](#如何添加自定义模型)
- [TODOs](#todos)
- [Contribution](#contribution)
## 用前须知
1. 此插件仍然在开发过程中，数据库的结构可能会发生变化**(如果改变，需要你自己修改数据库或者删除数据库)**
## 已知问题
1. 暂不支持Windows (因为ResourcePrecacher插件现在有问题)

## 依赖插件
1. [ResourcePrecacher](https://github.com/KillStr3aK/ResourcePrecacher)
2. [CS2Fixes](https://github.com/Source2ZE/CS2Fixes)

## 安装指南
从 [Release](https://github.com/samyycX/CS2-PlayerModelChanger/releases)下载最新版插件, 然后放到counterstrikesharp的plugins文件夹里

## 指令
### 服务器端
- `playermodelchanger_sync_resourceprecacher` 同步ResourcePrecacher的配置
- `playermodelchanger_enable [true/false]` 开启 / 关闭此插件
### 客户端
- `!model` 显示玩家当前用的模型
- `!model <model name>` 改变玩家的模型
- `!models` 显示所有可用的模型
- `!resetmodel` 重置玩家的模型

## 配置
如果你正确的安装了此插件，`counterstrikesharp/configs/plugins/PlayerModelChanger/PlayerModelChanger.json`文件会被生成。
然后根据下面的例子配置这个文件
```json
// This configuration was automatically generated by CounterStrikeSharp for plugin 'PlayerModelChanger', at 2024/02/23 11:41:05
{
  "ModelPaths": {
    "model name": "model path",
	"furina": "characters/maoling/genshin_impact/furina/normal/furina.vmdl", // for example
},
  "ConfigVersion": 1
}
```

## 如何添加自定义模型

### 把你的模型打包并上传到创意工坊
**如果你已经找到了一个含有你想要的模型的创意工坊, 可以跳过这部分**

前置:
- 你自己的模型
- Counter-Strike 2 Workshop Tools (可以在 `Steam客户端 -> cs2 -> 属性 -> DLC`里安装)

**Step 1.** 打开cs2安装目录, 找到 `game/csgo/gameinfo.gi`,
定位到文件最后，找到`AddonConfig -> VpkDirectories`
。然后添加你想要打包到VPK里的文件夹，下面是例子:


*例子*:
```json
AddonConfig	
	{
		"VpkDirectories"
		{
			"exclude"       "maps/content_examples"
			"include"       "maps"
			"include"		"characters" // 这是需要打包进去的文件夹
			"include"       "cfg/maps"
			"include"       "materials"
			"include"       "models"
			"include"       "panorama/images/overheadmaps"
			"include"       "panorama/images/map_icons"
			"include"       "particles"
			"include"       "resource/overviews"
			"include"       "scripts/vscripts"
			"include"       "sounds"
			"include"       "soundevents"
			"include"       "lighting/postprocessing"
			"include"       "postprocess"
			"include"       "addoninfo.txt"
		} 
		"AllowAddonDownload" "1"
		"AllowAddonDownloadForDemos" "1"
		"DisableAddonValidationForDemos" "1"
	}
```

**Step 2.** 启动 `Counter-Strike 2 Workshop Tools`, 然后点击 `Create New Addon`

**Step 3.** 前往目录 `./game/csgo_addons/<your addon name>/` 然后把你的character文件夹复制到这里

**Step 4.** 打开 `Asset Browser`, 然后点击右上角的 `Tools` 按钮， 打开 `Counter-Strike 2 Workshop Manager`

**Step 5.** 点击 `Counter-Strike 2 Workshop Manager` 里的 `New` 按钮, 把所有信息都填上，然后发布。

**Step 6.** 等待Steam审核。

### 设置 CS2Fixes
当你正确安装CS2Fixes插件后，会在`./game/csgo/cfg/cs2fixes/` 目录生成 `cs2fixes.cfg` 文件。
把 `cs2f_extra_addon` 后面的空字符串改成你需要的Workshop ID。

### 设置 ResourcePrecacher
#### 自动设置
1. 确保你已经成功安装了ResourcePrecacher并且有 `ResourcePrecacher.json` 在 `counterstrikesharp/configs/plugins/ResourcePrecacher` 文件夹里
2. 在控制台输入 `playermodelchanger_sync_resourceprecacher`。这个指令会把你设置的所有模型追加到ResourcePrecacher的配置里。 **(注意：这个指令不会覆写以前的配置。 如果你想重新设置，请确保你先删除了 `ResourcePrecacher.json` 里所有的模型配置)**
3. 重启服务器

#### 手动设置
1. 确保你已经成功安装了ResourcePrecacher并且有 `ResourcePrecacher.json` 在 `counterstrikesharp/configs/plugins/ResourcePrecacher` 文件夹里
2. 把你所有的模型路径加到 `ResourcePrecacher.json` 里
3. 重启服务器

### 设置 PlayerModelChanger
请看 [Configuration](#configuration) 部分

## TODOs
1. 翻译
2. 美化指令的输出

## Contribution
To build this plugin, run `dotnet build`.

Feel free to create Pull Requests or issues.